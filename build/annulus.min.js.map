{"version":3,"sources":["webpack://annulus/webpack/bootstrap","webpack://annulus/./index.js","webpack://annulus/./src/annulus/annulus.js"],"names":["app","annulus","App","container_id","GREEN","YELLOW","YELLOW2","RED","GREY","EXCITEMENT_SCALE","BACKGROUND","colorLerp","c1","c2","x","Math","floor","rgbToHex","rgb","toString","oscillator","n","i","frame","period","PI","sin","SVGArea","constructor","container_elem","svg_elem","document","createElementNS","setAttributeNS","viewbox","appendChild","v","_viewbox","Vis","_parent","_palette","_thickness","_segs","color0","c","color1","color2","colorbg","segments","thickness","update","elem","stressToColor","stress","scaled","RingVis","r","out_segs","in_segs","t","s","pow","_stress","color_str","lastChild","removeChild","debugg","circle","p","theta","theta_step","hdist","prev_px","prev_py","osc","_frame","re","re1","re2","prev_theta","tan","px","cos","py","cx1","cy1","cx2","cy2","toFixed","_showDebug","l1","h1","h2","WeerVis","y","y2","mouth","leye","reye","line_segs","soff","px1","py1","px2","py2","points","e","Annulus","svgarea","_time","_speed","_animate","_vis","_animateStress","_animateStressSign","pathg","showDebug","b","f","animate","start","animateStress","visualisation","animateStep","timestamp","delta","window","requestAnimationFrame","console","log","getElementById","body","createElement","className","visList","vis","backgroundColor","setupToolbox","_visstr","str","_background","style","background","toolbox","dat","GUI","f_a","addFolder","add","name","step","listen","open","f_c","addColor","f_p"],"mappings":"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","file":"annulus.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./index.js\");\n","import annulus from './src/annulus/annulus.js';\n\n//export default annulus;\n/*export default {\n    App : annulus.App\n};*/\n\nvar app = new annulus.App( { container_id: 'main' } );\n","const GREEN = [ 60, 200, 80 ];\nconst YELLOW = [ 250, 195, 50 ];\nconst YELLOW2 = [ 220, 209, 180 ];\nconst RED = [ 250, 30, 50 ];\nconst GREY = [ 150, 150, 150 ];\nconst EXCITEMENT_SCALE = 1.0;\nconst BACKGROUND = [ 50, 50, 50 ];\n \n/* \n * Utility functions \n */\n\n\n/* Given two rgb arrays [r,g,b] @c1 and @c2,\n * linearly interpolate between @c1 and @c2 at @x \n */\nfunction colorLerp( c1, c2, x ) {\n    return [\n        Math.floor(c2[0] * x + c1[0] * (1.0-x)),\n        Math.floor(c2[1] * x + c1[1] * (1.0-x)),\n        Math.floor(c2[2] * x + c1[2] * (1.0-x)) ];\n}\n\n/* Given an array of rgb values @rgb, return its HTML hex notation\n */\nfunction rgbToHex( rgb ) {\n    return '#' + rgb[0].toString(16) + rgb[1].toString(16) + rgb[2].toString(16);\n}\n\n/* Divides a sinewave 'oscillator' into @n segments, \n * then returns from the @i-th segment the value @frame on the interval [0;1)\n * The returned value is on the interval [0;1]\n */\nfunction oscillator( n, i, frame ) {\n    const period = Math.PI * (n*.789);\n    return (Math.sin( (i/n + frame) * period ) + 1.0) / 2.0; \n}\n\n/*\n *  SVGArea\n */\nclass SVGArea {\n    constructor( { container_elem = null } ) {\n        this.container_elem =container_elem;\n\n        this.svg_elem = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n        this.svg_elem.setAttributeNS(null, 'preserveAspectRatio', 'xMidYMid meet' );\n        this.viewbox = [0,0,100,100];\n        this.container_elem.appendChild(this.svg_elem);\n    }\n\n    set viewbox(v) {\n        this.svg_elem.setAttributeNS(null, 'viewBox', v[0] + ' ' + v[1] + ' ' + v[2] + ' ' + v[3]);\n        this._viewbox =v;\n    }\n\n    get viewbox() { return this._viewbox; }   \n}\n\n/*\n * Abstract 'Vis' class that represents a visualisation\n */\n\nclass Vis {\n    constructor( annulus ) {\n        this._parent   =annulus;\n        this._palette  =[[0,0,0],[0,0,0],[0,0,0],[0,0,0]];\n        this._thickness=0.5;\n        this._segs     =10;\n    }\n\n    get color0()        { return this._palette[0]; }\n    set color0(c)       { this._palette[0] =c; }\n    get color1()        { return this._palette[1]; }\n    set color1(c)       { this._palette[1] =c; }\n    get color2()        { return this._palette[2]; }\n    set color2(c)       { this._palette[2] =c; }\n    get colorbg()       { return this._palette[3]; }\n    set colorbg(c)      { this._palette[3] =c; }\n\n    get segments()      { return this._segs; }\n    set segments(n)     { this._segs = n; }\n\n    get thickness()     { return this._thickness; }\n    set thickness(n)    { this._thickness =n; }\n    \n    update( elem )      { }\n    \n    /* Linearly interpolate over _palette 0..2 by @stress on interval [0;1], using .5 as midpoint \n     */\n    stressToColor( stress ) {\n        // Linearly interpolate over the colors in _palette using .5 as midpoint\n        let scaled = stress / EXCITEMENT_SCALE;\n\n        return (scaled < .5)\n            ? colorLerp( this._palette[0], this._palette[1], scaled * 2.0 )\n            : colorLerp( this._palette[1], this._palette[2], (scaled-.5) * 2.0 );\n    }\n\n}\n\nclass RingVis extends Vis {\n    constructor( annulus ) {\n        super( annulus );\n        this._palette  =[GREEN,YELLOW,RED,BACKGROUND];\n        this._thickness=0.5;\n        this._segs     =50;\n    }\n\n    /* Return the SVG path obtained by rendering with the current parameters.\n     * Additionally, if showDebug is true, this function adds points and handles to the debugg SVG group element.\n     */\n    update( elem ) {\n        const r = 1.0;\n        const out_segs = this.segments; // Number of inner segments\n        const in_segs = this.segments; // Number of outer segments\n        const thickness = this.thickness; // Thickness of the ring\n        const t = r * (1.0-thickness);\n        const s = Math.pow( this._parent._stress / EXCITEMENT_SCALE,  2 ) + 0.05;\n        const color_str =rgbToHex( super.stressToColor( this._parent.stress ) ); \n\n        // Clear out the old stuff\n        while( elem.lastChild ) elem.removeChild( elem.lastChild );\n        while( this._parent.debugg.lastChild ) this._parent.debugg.removeChild( this._parent.debugg.lastChild );\n        \n        // Step one, the central path (cicle/cloud shape)\n        let circle = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n        circle.setAttributeNS(null, 'fill', color_str);\n        elem.appendChild(circle);\n\n        let p = \"\";\n        \n        let theta =0;\n        let theta_step =(Math.PI*2)/out_segs;\n        let hdist =0;\n       \n        let prev_px =0; let prev_py =0;\n\n        for( let i =0; i <= out_segs; i++) {\n            \n            let osc =oscillator( out_segs, i % out_segs, this._parent._frame);  \n            let re =r + (osc+.5)  * s / (r*4);\n            let re1=r - (1-osc+.5) * s / (r*8);\n            let re2=r - (1-osc+.5) * s / (r*8);\n            \n            let prev_theta =theta;\n            theta += theta_step * (1-osc+.48);\n            //theta =next_theta();\n\n            if( i == out_segs ) theta = 2*Math.PI;\n\n            hdist =(4/3)*Math.tan( (theta-prev_theta)/4 );\n\n            let px =Math.cos( theta ) * re;\n            let py =Math.sin( theta ) * re;\n            \n            let cx1=(Math.cos( prev_theta ) - hdist * Math.sin( prev_theta )) * re1;\n            let cy1=(Math.sin( prev_theta ) + hdist * Math.cos( prev_theta )) * re1;\n\n            let cx2=(Math.cos( theta ) + hdist * Math.sin( theta  )) * re2;\n            let cy2=(Math.sin( theta ) - hdist * Math.cos( theta  )) * re2;\n            \n            if( i == 0 ) {\n                p += \" M\" + 1*re + \",\" + 0*re;\n                prev_px = 1*re; prev_py = 0*re;\n            }\n            p += \" C\" \n                + cx1.toFixed(5) + \",\" + cy1.toFixed(5) + \" \" \n                + cx2.toFixed(5) + \",\" + cy2.toFixed(5) + \" \" \n                + px.toFixed(5) + \",\" + py.toFixed(5);\n            \n            if( this._parent._showDebug ) {\n\n                // Only boring debug-stuffs below\n\n                let l1 = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n                l1.setAttributeNS(null, 'stroke-width', '0.002');\n                l1.setAttributeNS(null, 'stroke', 'white');\n                l1.setAttributeNS(null, 'd', \"M\"  \n                        + cx2.toFixed(5) + \",\" + cy2.toFixed(5) + \" L\" \n                        + px.toFixed(5) + \",\" + py.toFixed(5) + \" M\"\n                        + cx1.toFixed(5) + \",\" + cy1.toFixed(5) + \" L\" \n                        + prev_px.toFixed(5) + \",\" + prev_py + \" Z\" ); \n                this._parent.debugg.appendChild(l1);\n                \n                let h1 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n                h1.setAttributeNS(null, 'fill', 'magenta');\n                h1.setAttributeNS(null, 'width', '0.02');\n                h1.setAttributeNS(null, 'height', '0.02');\n                h1.setAttributeNS(null, 'x', cx1.toFixed(5)-0.01 );\n                h1.setAttributeNS(null, 'y', cy1.toFixed(5)-0.01 );\n                this._parent.debugg.appendChild(h1);\n                \n                let h2 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n                h2.setAttributeNS(null, 'fill', 'cyan');\n                h2.setAttributeNS(null, 'width', '0.02');\n                h2.setAttributeNS(null, 'height', '0.02');\n                h2.setAttributeNS(null, 'x', cx2.toFixed(5)-0.01 );\n                h2.setAttributeNS(null, 'y', cy2.toFixed(5)-0.01 );\n                this._parent.debugg.appendChild(h2);\n                \n                let c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n                c.setAttributeNS(null, 'fill', 'red');\n                c.setAttributeNS(null, 'r', '0.01');\n                c.setAttributeNS(null, 'cx', px.toFixed(5) );\n                c.setAttributeNS(null, 'cy', py.toFixed(5) );\n                this._parent.debugg.appendChild(c);\n            }\n\n            prev_px =px; prev_py =py;\n\n        }\n        \n        theta =0;\n        theta_step =-(Math.PI*2)/in_segs;\n\n        for( let i =0 ; i <= in_segs; i++ ) {\n            let osc =oscillator( in_segs, i % in_segs, this._parent._frame);  \n            let re =t;// + (osc)  * 0.02\n            let re1=t;// + (osc)  * 0.01\n            let re2=t;// + (1-osc)* 0.01\n            \n            let prev_theta =theta;\n            theta += theta_step * (1-osc+.49);\n\n            if( i == in_segs ) theta = 2*Math.PI;\n\n            hdist =(4/3)*Math.tan( (theta-prev_theta)/4 );\n\n            let px =Math.cos( theta ) * re;\n            let py =Math.sin( theta ) * re;\n            \n            let cx1=(Math.cos( prev_theta ) - hdist * Math.sin( prev_theta )) * re1;\n            let cy1=(Math.sin( prev_theta ) + hdist * Math.cos( prev_theta )) * re1;\n\n            let cx2=(Math.cos( theta ) + hdist * Math.sin( theta  )) * re2;\n            let cy2=(Math.sin( theta ) - hdist * Math.cos( theta  )) * re2;\n            \n            if( i == 0 ) {\n                p += \" M\" + 1*re + \",\" + 0*re;\n                prev_px = 1*re; prev_py = 0*re;\n            }\n            p += \" C\" \n                + cx1.toFixed(5) + \",\" + cy1.toFixed(5) + \" \" \n                + cx2.toFixed(5) + \",\" + cy2.toFixed(5) + \" \" \n                + px.toFixed(5) + \",\" + py.toFixed(5);\n        }\n\n\n        circle.setAttributeNS(null, 'd', p);\n    }\n}\n\nclass WeerVis extends Vis {\n    constructor( annulus ) {\n        super( annulus );\n        this._palette  =[YELLOW,YELLOW2,GREY,BACKGROUND];\n        this._thickness=0.5;\n        this._segs     =10;\n    }\n\n    /* Return the SVG path obtained by rendering with the current parameters.\n     * Additionally, if showDebug is true, this function adds points and handles to the debugg SVG group element.\n     */\n    update( elem ) {\n        const r = 1.0;\n        const out_segs = this.segments; // Number of inner segments\n        const in_segs = this.segments; // Number of outer segments\n        const thickness = this.thickness; // Thickness of the ring\n        const t = r * (1.0-thickness);\n        const s = Math.pow( this._parent._stress / EXCITEMENT_SCALE,  2 );// + 0.05;\n        const color_str =rgbToHex( super.stressToColor( this._parent.stress ) ); \n\n        // Clear out old stuff\n        while( this._parent.debugg.lastChild ) this._parent.debugg.removeChild( this._parent.debugg.lastChild );\n        while( elem.lastChild ) elem.removeChild( elem.lastChild );\n\n        // Step one, the central path (cicle/cloud shape)\n        let circle = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n        circle.setAttributeNS(null, 'fill', color_str);\n        elem.appendChild(circle);\n        \n        let p = \"\";\n        \n        let theta =0;\n        let theta_step =(Math.PI*2)/out_segs;\n        let hdist =0;\n       \n        let prev_px =0; let prev_py =0;\n\n        for( let i =0; i < out_segs; i++) {\n            \n            let osc =oscillator( out_segs-1, i % (out_segs-1), this._parent._frame);  \n            let re1 =r + (osc+.5)   * s / (r*8);\n            let re2 =r - (1-osc+.5) * s / (r*16);\n            \n            let prev_theta =theta;\n            if( i == out_segs - 1 )\n                theta =Math.PI*2;\n            else\n                theta += theta_step * .75 + theta_step * .25 * (1-osc+.45);\n            //theta +=theta_step;\n            //theta =next_theta();\n\n\n            hdist =(4/3)*Math.tan( (theta-prev_theta)/4 );\n\n            let px =Math.cos( theta ) * re2;\n            let py =Math.sin( theta ) * re2;\n            \n            let cx1=(Math.cos( prev_theta ) - hdist * Math.sin( prev_theta )) * re1;\n            let cy1=(Math.sin( prev_theta ) + hdist * Math.cos( prev_theta )) * re1;\n\n            let cx2=(Math.cos( theta ) + hdist * Math.sin( theta  )) * re1;\n            let cy2=(Math.sin( theta ) - hdist * Math.cos( theta  )) * re1;\n            \n            if( i == 0 ) {\n                p += \" M\" + 1*re2 + \",\" + 0*re2;\n                prev_px = 1*re2; prev_py = 0*re2;\n            }\n            p += \" C\" \n                + cx1.toFixed(5) + \",\" + cy1.toFixed(5) + \" \" \n                + cx2.toFixed(5) + \",\" + cy2.toFixed(5) + \" \" \n                + px.toFixed(5) + \",\" + py.toFixed(5);\n            \n            if( this._parent._showDebug ) {\n\n                // Only boring debug-stuffs below\n\n                let l1 = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n                l1.setAttributeNS(null, 'stroke-width', '0.002');\n                l1.setAttributeNS(null, 'stroke', 'white');\n                l1.setAttributeNS(null, 'd', \"M\"  \n                        + cx2.toFixed(5) + \",\" + cy2.toFixed(5) + \" L\" \n                        + px.toFixed(5) + \",\" + py.toFixed(5) + \" M\"\n                        + cx1.toFixed(5) + \",\" + cy1.toFixed(5) + \" L\" \n                        + prev_px.toFixed(5) + \",\" + prev_py + \" Z\" ); \n                this._parent.debugg.appendChild(l1);\n                \n                let h1 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n                h1.setAttributeNS(null, 'fill', 'magenta');\n                h1.setAttributeNS(null, 'width', '0.02');\n                h1.setAttributeNS(null, 'height', '0.02');\n                h1.setAttributeNS(null, 'x', cx1.toFixed(5)-0.01 );\n                h1.setAttributeNS(null, 'y', cy1.toFixed(5)-0.01 );\n                this._parent.debugg.appendChild(h1);\n                \n                let h2 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n                h2.setAttributeNS(null, 'fill', 'cyan');\n                h2.setAttributeNS(null, 'width', '0.02');\n                h2.setAttributeNS(null, 'height', '0.02');\n                h2.setAttributeNS(null, 'x', cx2.toFixed(5)-0.01 );\n                h2.setAttributeNS(null, 'y', cy2.toFixed(5)-0.01 );\n                this._parent.debugg.appendChild(h2);\n                \n                let c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n                c.setAttributeNS(null, 'fill', 'red');\n                c.setAttributeNS(null, 'r', '0.01');\n                c.setAttributeNS(null, 'cx', px.toFixed(5) );\n                c.setAttributeNS(null, 'cy', py.toFixed(5) );\n                this._parent.debugg.appendChild(c);\n            }\n\n            prev_px =px; prev_py =py;\n\n        }\n        circle.setAttributeNS(null, 'd', p);\n        \n        // Step two. The face\n        let y = .25 * r;\n        let y2 =.5 - this._parent._stress / EXCITEMENT_SCALE;\n         \n        // Mouth\n        p = \" M \" + -.5 * r + \", \" + y + \" Q0, \" + (y2 + y * r) + \", \" + .5 * r + \", \" + y;\n        let mouth = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n        mouth.setAttributeNS(null, 'fill', 'none');\n        mouth.setAttributeNS(null, 'stroke', rgbToHex(this.colorbg));\n        mouth.setAttributeNS(null, 'stroke-width', .1 * r);\n        mouth.setAttributeNS(null, 'stroke-linecap', 'round');\n        mouth.setAttributeNS(null, 'd', p );\n        elem.appendChild(mouth);\n\n        // Eyes\n        let leye = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n        leye.setAttributeNS(null, 'fill', rgbToHex(this.colorbg));\n        leye.setAttributeNS(null, 'r', .05 * r);\n        leye.setAttributeNS(null, 'cx', -.7 * r);\n        leye.setAttributeNS(null, 'cy', 0);\n        elem.appendChild(leye);\n        \n        let reye = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n        reye.setAttributeNS(null, 'fill', rgbToHex(this.colorbg));\n        reye.setAttributeNS(null, 'r', .05 * r);\n        reye.setAttributeNS(null, 'cx', .7 * r);\n        reye.setAttributeNS(null, 'cy', 0);\n        elem.appendChild(reye);\n\n\n      /*  let l = this._parent._stress < .5 ? 0 : 1;\n        let r2=(10 * (.5 - Math.abs(.5 - this._parent._stress)) + .5) * r; \n        p = \" M \" + -.5 * r + \", 0 A\" + r2 + \", \" + r2 + \" 0 0,\" + l + \" \" + .5 * r + \",0\";\n        let mouth = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n        mouth.setAttributeNS(null, 'fill', 'none');\n        mouth.setAttributeNS(null, 'stroke', 'black');\n        mouth.setAttributeNS(null, 'stroke-width', .1 * r);\n        mouth.setAttributeNS(null, 'd', p );\n        elem.appendChild(mouth);*/\n\n\n        // Step three. The rays/sparks/lines\n        // Each line is a separate <polyline> that consists of four points\n        let line_segs =2 * in_segs + in_segs * 2 * (1- this._parent._stress); \n        //let skip_lines =Math.floor(in_segs * 2 * (1.1- this._parent._stress)); \n        theta =0;//Math.PI /4 * s;\n        theta_step =-(Math.PI*2)/line_segs;// + (Math.PI*2)/(in_segs*4);\n\n        for( let i =0 ; i < line_segs; i++ ) {\n            let osc =oscillator( line_segs, i % (line_segs), this._parent._frame);  \n            let soff= r * 0.15 * s;     // Stress factor in offset from inner circle\n            let re  = 1.1 * r + .2 * r * osc + soff; // Distance of tangential line\n            let re1 = re + soff;         // Distance of outmost point\n            let re2 = re - soff;         // Distance of innermost point\n            \n            let prev_theta =theta;\n            if( i == line_segs - 1 )\n                theta =0;//Math.PI/4 * s - theta_step;\n            else\n                theta += theta_step * .75 + theta_step * .25 * (1-osc+.45);\n\n            //if( i % skip_lines == 0 ) continue;\n\n            hdist =(4/3)*Math.tan( (theta-prev_theta)/4 );\n\n            // Points of the middle/tangential line\n            let px1 =Math.cos( prev_theta ) * re;\n            let py1 =Math.sin( prev_theta ) * re;\n            \n            let px2 =Math.cos( theta - .75 * theta_step ) * re;\n            let py2 =Math.sin( theta - .75 * theta_step ) * re;\n            \n        \n            // Outer/inner points that form the 'spark'     \n            let cx1=Math.cos( prev_theta ) * re1;\n            let cy1=Math.sin( prev_theta ) * re1;\n\n            let cx2=Math.cos( theta  - .75 * theta_step ) * re2;\n            let cy2=Math.sin( theta  - .75 * theta_step ) * re2;\n           \n            let points = cx1 + \",\" + cy1 + \" \" + px1 + \",\" + py1 + \" \" + px2 + \",\" + py2 + \" \" + cx2 + \",\" + cy2;\n            let e= document.createElementNS('http://www.w3.org/2000/svg', 'polyline');\n            e.setAttributeNS(null, 'fill', 'none');\n            e.setAttributeNS(null, 'stroke', color_str/*rgbToHex(this.color0)*/);\n            e.setAttributeNS(null, 'stroke-width', .05 * r);\n            e.setAttributeNS(null, 'stroke-linecap', 'round');\n            e.setAttributeNS(null, 'stroke-linejoin', 'round');\n            e.setAttributeNS(null, 'points', points );\n            elem.appendChild(e);\n\n        }\n\n    }\n}\n\nclass Annulus {\n\n    constructor( svgarea  ) {\n        this._stress            =0.0;\n        this._showDebug         =false;\n        this._frame             =0;\n        this._time              =0;\n        this._speed             =0.000008;\n        this._animate           =true;\n        this._vis               =null;\n        this._animateStress     =false;\n        this._animateStressSign =1.0;\n        this.svgarea = svgarea;\n\n        svgarea.viewbox = [-2,-2,4,4];\n        \n        \n        // Add a group for visualisation elements\n        this.pathg = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n        this.svgarea.svg_elem.appendChild(this.pathg);\n        \n        // Add another group for debug elements\n        this.debugg = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n        this.svgarea.svg_elem.appendChild(this.debugg);\n\n\n    }\n    \n    get color0()        { return this._vis.color0; }\n    set color0(c)       { this._vis.color0 =c; this.update(); }\n    get color1()        { return this._vis.color1; }\n    set color1(c)       { this._vis.color1 =c; this.update(); }\n    get color2()        { return this._vis.color2; }\n    set color2(c)       { this._vis.color2 =c; this.update(); }\n    get colorbg()       { return this._vis.colorbg; }\n    set colorbg(c)      { this._vis.colorbg =c; this.update(); }\n\n    get stress()        { return this._stress; }\n    set stress(e)       { this._stress = e; this.update(); }\n\n    get showDebug()     { return this._showDebug; }\n    set showDebug(b)    { this._showDebug =b; this.update(); }\n\n    get frame()         { return this._frame; }\n    set frame(f)        { this._frame =f; this.update(); }\n\n    get animate()       { return this._animate; }\n    set animate(b)      { this._animate = b; this.start(); }\n\n    get animateStress() { return this._animateStress; }\n    set animateStress(b){ this._animateStress =b; }\n\n    get segments()      { return this._vis.segments; }\n    set segments(n)     { this._vis.segments = n; this.update() }\n\n    get thickness()     { return this._vis.thickness; }\n    set thickness(n)    { this._vis.thickness =n; this.update() }\n\n    get visualisation() { return this._vis; }\n    set visualisation(v){ this._vis =v; this.update(); }\n    \n\n    update() {\n        this._vis.update( this.pathg );\n    }\n\n    start() {\n        if( this._animate == false ) return;\n\n        const animateStep = (timestamp) => {\n            if( this._animate == false ) return;\n            if( !this._time ) this._time =timestamp;\n            let delta = timestamp - this._time;\n            \n            if( this._animateStress == true ) {\n\n                this._stress += delta * 0.0001 * this._animateStressSign;\n                if( this._stress >= 1.0 ) {\n                    this._animateStressSign =-1.0;\n                    this._stress =1.0;\n                } else if( this._stress <= 0.0 ) {\n                    this._animateStressSign =1.0;\n                    this._stress =0.0;\n                }\n            }\n            \n            this._frame += delta * (this._speed + this._stress * this._speed);\n            while( this._frame >= 1.0 ) this._frame -= 1.0;\n\n            this._time = timestamp;\n            this.update();\n            window.requestAnimationFrame( animateStep );\n        }\n        window.requestAnimationFrame( animateStep );\n    }\n\n\n\n\n}\n\nclass App {\n    constructor( { container_id ='' } ) {\n        console.log( 'niemand ter aarde weet, hoe het eigenlijk begon, het droevige verhaal van de nozem en de non' );\n\n\n        // Create a viewport container inside the given element id\n        this.container_elem =document.getElementById( container_id );\n        if( typeof this.container_elem == 'undefined' )\n            this.container_elem =document.body;\n\n        let svg_elem = document.createElement( 'object' );\n            svg_elem.className = 'svgarea';\n        this.container_elem.appendChild( svg_elem );\n\n        this.svgarea = new SVGArea( { container_elem: svg_elem } );\n\n        this.annulus = new Annulus( this.svgarea );\n\n        this.visList = { \"Ring\" : new RingVis( this.annulus ), \"Weer\" : new WeerVis( this.annulus ) };\n        this._vis =\"\";\n        this.vis = \"Weer\";\n        this.annulus.start();\n\n        this.backgroundColor = BACKGROUND;\n        this.setupToolbox();\n    }\n\n    get vis()   { return this._visstr; }\n    set vis(str){ \n        this._visstr =str;\n        this.annulus.visualisation =this.visList[str];\n        this.annulus.update();\n    }\n\n    get backgroundColor() { return this._background; }\n\n    set backgroundColor(c) {\n        this._background =c;\n        document.body.style.background = rgbToHex(c);\n        this.annulus.colorbg =c;\n        this.annulus.update();\n    }\n\n    setupToolbox() {\n        this.toolbox = new dat.GUI( );\n        \n        let f_a = this.toolbox.addFolder( 'Annulus' );\n        f_a.add( this.annulus, 'stress', 0.0, EXCITEMENT_SCALE ).name( 'Stress' ).step( 0.01 * EXCITEMENT_SCALE ).listen();\n        f_a.add( this, 'vis', [ \"Ring\", \"Weer\" ] ).name( 'Vis' );\n        f_a.open();\n\n        // Colors toolbox\n        let f_c = this.toolbox.addFolder( 'Colors' );\n        f_c.addColor( this.annulus, 'color0' ).name( 'Low' ).listen() ;\n        f_c.addColor( this.annulus, 'color1' ).name( 'Medium' ).listen();\n        f_c.addColor( this.annulus, 'color2' ).name( 'High' ).listen();\n        f_c.addColor( this, 'backgroundColor' ).name( 'Background' ).listen();\n        f_c.open();\n        \n        let f_p = this.toolbox.addFolder( 'Parameters' );\n        f_p.add( this.annulus, 'showDebug' ).name( 'Debug' );\n        //f_p.add( this.annulus, 'frame', 0.0, 1.0 ).name( 'Frame' ).step( 0.01);\n        f_p.add( this.annulus, 'segments', 10, 100 ).name( 'Segments' ).step( 1 ).listen();\n        f_p.add( this.annulus, 'thickness', 0, 1 ).name( 'Thickness' ).step( 0.05 ).listen();\n        f_p.add( this.annulus, 'animate' ).name( 'Animate' );\n        f_p.add( this.annulus, 'animateStress' ).name( 'Animate Stress' );\n        f_p.open();\n\n    }\n}\n\nexport default {\n    App : App\n};\n"],"sourceRoot":""}