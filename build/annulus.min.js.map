{"version":3,"sources":["webpack://annulus/webpack/bootstrap","webpack://annulus/./index.js","webpack://annulus/./src/annulus/annulus.js"],"names":["app","annulus","App","container_id","GREEN","YELLOW","YELLOW2","RED","GREY","EXCITEMENT_SCALE","BACKGROUND","FACE_NONE","FACE_SIMPLE","FACE_TROUBLED","FACE_SAD","FACE_COMPLEX","colorLerp","c1","c2","x","Math","floor","rgbToHex","rgb","toString","oscillator","n","i","frame","period","PI","sin","SVGArea","constructor","container_elem","svg_elem","document","createElementNS","setAttributeNS","viewbox","appendChild","v","_viewbox","Vis","_parent","_palette","_thickness","_segs","_face","color0","c","color1","color2","colorbg","segments","thickness","face","b","update","elem","stressToColor","stress","scaled","makeFace","r","color","makePath","p","m","y","y2","_stress","leye","reye","y1","x3","y3","eyes","dy1","dy2","dy3","s","s1","s2","dy4","dx0","dx1","dx2","dx3","dx4","RingVis","out_segs","in_segs","t","pow","col","color_str","lastChild","removeChild","debugg","circle","theta","theta_step","hdist","prev_px","prev_py","osc","_frame","re","re1","re2","prev_theta","tan","px","cos","py","cx1","cy1","cx2","cy2","toFixed","_showDebug","l1","h1","h2","WeerVis","line_segs","soff","px1","py1","px2","py2","points","e","Annulus","svgarea","_time","_speed","_animate","_vis","_animateStress","_animateStressSign","pathg","showDebug","f","animate","start","animateStress","visualisation","animateStep","timestamp","delta","window","requestAnimationFrame","console","log","getElementById","body","createElement","className","visList","vis","backgroundColor","setupToolbox","_visstr","str","_background","style","background","toolbox","dat","GUI","f_a","addFolder","add","name","step","listen","None","Simple","Troubled","Sad","Complex","open","f_c","addColor","f_p"],"mappings":"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","file":"annulus.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./index.js\");\n","import annulus from './src/annulus/annulus.js';\n\n//export default annulus;\n/*export default {\n    App : annulus.App\n};*/\n\nvar app = new annulus.App( { container_id: 'main' } );\n","const GREEN = [ 60, 200, 80 ];\nconst YELLOW = [ 250, 195, 50 ];\nconst YELLOW2 = [ 220, 209, 180 ];\nconst RED = [ 250, 30, 50 ];\nconst GREY = [ 150, 150, 150 ];\nconst EXCITEMENT_SCALE = 1.0;\nconst BACKGROUND = [ 50, 50, 50 ];\n// Face 'enum'\nconst FACE_NONE =0;\nconst FACE_SIMPLE =1;\nconst FACE_TROUBLED =2;\nconst FACE_SAD =3;\nconst FACE_COMPLEX =4;\n \n/* \n * Utility functions \n */\n\n\n/* Given two rgb arrays [r,g,b] @c1 and @c2,\n * linearly interpolate between @c1 and @c2 at @x \n */\nfunction colorLerp( c1, c2, x ) {\n    return [\n        Math.floor(c2[0] * x + c1[0] * (1.0-x)),\n        Math.floor(c2[1] * x + c1[1] * (1.0-x)),\n        Math.floor(c2[2] * x + c1[2] * (1.0-x)) ];\n}\n\n/* Given an array of rgb values @rgb, return its HTML hex notation\n */\nfunction rgbToHex( rgb ) {\n    return '#' + rgb[0].toString(16) + rgb[1].toString(16) + rgb[2].toString(16);\n}\n\n/* Divides a sinewave 'oscillator' into @n segments, \n * then returns from the @i-th segment the value @frame on the interval [0;1)\n * The returned value is on the interval [0;1]\n */\nfunction oscillator( n, i, frame ) {\n    const period = Math.PI * (n*.789);\n    return (Math.sin( (i/n + frame) * period ) + 1.0) / 2.0; \n}\n\n/*\n *  SVGArea\n */\nclass SVGArea {\n    constructor( { container_elem = null } ) {\n        this.container_elem =container_elem;\n\n        this.svg_elem = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n        this.svg_elem.setAttributeNS(null, 'preserveAspectRatio', 'xMidYMid meet' );\n        this.viewbox = [0,0,100,100];\n        this.container_elem.appendChild(this.svg_elem);\n    }\n\n    set viewbox(v) {\n        this.svg_elem.setAttributeNS(null, 'viewBox', v[0] + ' ' + v[1] + ' ' + v[2] + ' ' + v[3]);\n        this._viewbox =v;\n    }\n\n    get viewbox() { return this._viewbox; }   \n}\n\n/*\n * Abstract 'Vis' class that represents a visualisation\n */\n\nclass Vis {\n    constructor( annulus ) {\n        this._parent   =annulus;\n        this._palette  =[[0,0,0],[0,0,0],[0,0,0],[0,0,0]];\n        this._thickness=0.5;\n        this._segs     =10;\n        this._face     =FACE_NONE;\n    }\n\n    get color0()        { return this._palette[0]; }\n    set color0(c)       { this._palette[0] =c; }\n    get color1()        { return this._palette[1]; }\n    set color1(c)       { this._palette[1] =c; }\n    get color2()        { return this._palette[2]; }\n    set color2(c)       { this._palette[2] =c; }\n    get colorbg()       { return this._palette[3]; }\n    set colorbg(c)      { this._palette[3] =c; }\n\n    get segments()      { return this._segs; }\n    set segments(n)     { this._segs = n; }\n\n    get thickness()     { return this._thickness; }\n    set thickness(n)    { this._thickness =n; }\n\n    get face()          { return this._face; }\n    set face(b)         { this._face =b; }\n    \n    update( elem )      { }\n    \n    /* Linearly interpolate over _palette 0..2 by @stress on interval [0;1], using .5 as midpoint \n     */\n    stressToColor( stress ) {\n        // Linearly interpolate over the colors in _palette using .5 as midpoint\n        let scaled = stress / EXCITEMENT_SCALE;\n\n        return (scaled < .5)\n            ? colorLerp( this._palette[0], this._palette[1], scaled * 2.0 )\n            : colorLerp( this._palette[1], this._palette[2], (scaled-.5) * 2.0 );\n    }\n\n    makeFace( elem, r, color ) {\n        var makePath =function( elem, p, r, color ) {\n            let m = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n            m.setAttributeNS(null, 'fill', 'none');\n            m.setAttributeNS(null, 'stroke', rgbToHex(color));\n            m.setAttributeNS(null, 'stroke-width', .1 * r);\n            m.setAttributeNS(null, 'stroke-linecap', 'round');\n            m.setAttributeNS(null, 'd', p );\n            elem.appendChild(m);\n        }\n        if( this.face == FACE_SIMPLE ) {\n            let y = .25 * r;\n            let y2 =r * (.5 - this._parent._stress / EXCITEMENT_SCALE);\n             \n            // Mouth\n            let p = \" M \" + -.5 * r + \", \" + y + \" Q0, \" + (y2 + y) + \", \" + .5 * r + \", \" + y;\n            makePath( elem, p, r, color );\n\n            // Eyes\n            let leye = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n            leye.setAttributeNS(null, 'fill', rgbToHex(color));\n            leye.setAttributeNS(null, 'r', .05 * r);\n            leye.setAttributeNS(null, 'cx', -.7 * r);\n            leye.setAttributeNS(null, 'cy', 0);\n            elem.appendChild(leye);\n            \n            let reye = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n            reye.setAttributeNS(null, 'fill', rgbToHex(color));\n            reye.setAttributeNS(null, 'r', .05 * r);\n            reye.setAttributeNS(null, 'cx', .7 * r);\n            reye.setAttributeNS(null, 'cy', 0);\n            elem.appendChild(reye);\n        } else if ( this.face == FACE_TROUBLED ) {\n            \n            // Mouth\n            let y = .25 * r;\n            let y1 = r * .5;\n            let y2 = r * (.5 - this._parent._stress / EXCITEMENT_SCALE);\n             \n            let p = \" M\" + -.5 * r + \", \" + y \n                + \" C\" + -.25 * r + \", \" + (y2 + y) \n                + \" \" + .25 * r + \", \" + (y1 + y) \n                + \" \" + .5 * r + \", \" + y;\n            makePath( elem, p, r, color );\n\n            // Eyes\n            let x3 = r * (.2 * this._parent._stress / EXCITEMENT_SCALE); \n            let y3 = r * (.12 * this._parent._stress / EXCITEMENT_SCALE); \n\n            let eyes = \" M\" + -.6 * r + \", \" + 0\n                     + \" l\" + (-x3) + \", \" + (-y3)\n                     + \" M\" + -.6 * r + \", \" + 0\n                     + \" l\" + (-x3) + \", \" + y3\n                     + \" M\" + .6 * r + \", \" + 0\n                     + \" l\" + x3 + \", \" + (-y3)\n                     + \" M\" + .6 * r + \", \" + 0\n                     + \" l\" + x3 + \", \" + y3;\n            makePath( elem, eyes, r, color );\n        } else if ( this.face == FACE_SAD ) {\n            \n            // Mouth\n            let y = .25 * r;\n            let dy1 = r * .5;\n            let dy2 = r * (.5 - this._parent._stress / EXCITEMENT_SCALE);\n             \n            let p = \" M\" + -.5 * r + \", \" + y \n                + \" C\" + -.25 * r + \", \" + (dy2 + y) \n                + \" \" + .25 * r + \", \" + (dy1 + y) \n                + \" \" + .5 * r + \", \" + y;\n            makePath( elem, p, r, color );\n\n            // Eyes\n            let x3 = r * (.15 * this._parent._stress / EXCITEMENT_SCALE); \n            let dy3 = r * (.05 * this._parent._stress / EXCITEMENT_SCALE); \n\n            let eyes = \" M\" + -.6 * r + \", \" + (-dy3)\n                     + \" l\" + x3 + \", \" + (-dy3*2)\n                     + \" M\" + .6 * r + \", \" + (-dy3)\n                     + \" l\" + (-x3) + \", \" + (-dy3*2)\n            makePath( elem, eyes, r, color );\n        } else if ( this.face == FACE_COMPLEX ) {\n            // Mouth\n            let y = .25 * r;\n            let s = this._parent._stress / EXCITEMENT_SCALE;\n            let s1 = s >= 0.5 ? 1.0 : s * 2.0;\n            let s2 = s <  0.5 ? 0.0 : (s - .5) * 2.0;\n            let dy1 = r * (.25 - .25 * s1);\n            let dy2 = r * .25 * s2;\n            let dy3 = r * (.2 - .2 * s1);\n            let dy4 = r * (.33 - .33 * s1 - .17 * s2);\n            let dx0 = r * .5;\n            let dx1 = r * (.25 - .06 * s1);\n            let dx2 = r * .125 * s1;\n            let dx3 = r * (.125 - .125 * s1); \n            let dx4 = r * (.375 - .125 * s1); \n\n            let p = \" M\" + (-dx0) + \", \" + y            // P0 \n                + \" C\" + (-dx0+dx2) + \", \" + (y-dy2) \n                + \" \" + (-dx4) + \", \" + (y + dy3) \n                + \" \" + (-dx1) + \", \" + (y + dy1)       // P1\n                + \" m0,0\"\n                + \" C\" + (-dx3) + \", \" + (y + dy4) \n                + \" \" + (dx3) + \", \" + (y + dy4) \n                + \" \" + (dx1) + \", \" + (y + dy1)        // P2\n                + \" m0,0\"\n                + \" C\" + (dx4) + \", \" + (y + dy3) \n                + \" \" + (dx0-dx2) + \", \" + ( y-dy2) \n                + \" \" + (dx0) + \", \" + y;               // P3\n            makePath( elem, p, r, color );\n\n            // Eyes\n            dx1 = r * .3;\n            dx2 = r * (.2 * s1); \n            dx3 = r * (.2 * s1); \n            dy1 = r * -.2;\n            dy2 = r * (.1 + 0 * s2); \n            dy3 = r * (.1 - .2 * s2); \n\n            let eyes = \" M\" + -dx1 + \", \" + dy1\n                     + \" l\" + (-dx3) + \", \" + (dy3)\n                     + \" M\" + -dx1 + \", \" + dy1\n                     + \" l\" + (-dx2) + \", \" + dy2\n                     + \" M\" + dx1 + \", \" + dy1\n                     + \" l\" + dx3 + \", \" + (dy3)\n                     + \" M\" + dx1 + \", \" + dy1\n                     + \" l\" + dx2 + \", \" + dy2;\n            makePath( elem, eyes, r, color );\n\n        }\n\n    }\n\n}\n\nclass RingVis extends Vis {\n    constructor( annulus ) {\n        super( annulus );\n        this._palette  =[GREEN,YELLOW,RED,BACKGROUND];\n        this._thickness=0.5;\n        this._segs     =50;\n    }\n\n    /* Return the SVG path obtained by rendering with the current parameters.\n     * Additionally, if showDebug is true, this function adds points and handles to the debugg SVG group element.\n     */\n    update( elem ) {\n        const r = 1.0;\n        const out_segs = this.segments; // Number of inner segments\n        const in_segs = this.segments; // Number of outer segments\n        const thickness = this.thickness; // Thickness of the ring\n        const t = r * (1.0-thickness);\n        const s = Math.pow( this._parent._stress / EXCITEMENT_SCALE,  2 ) + 0.05;\n        const col = super.stressToColor( this._parent.stress );\n        const color_str =rgbToHex( col ); \n\n        // Clear out the old stuff\n        while( elem.lastChild ) elem.removeChild( elem.lastChild );\n        while( this._parent.debugg.lastChild ) this._parent.debugg.removeChild( this._parent.debugg.lastChild );\n        \n        // Step one, the central path (cicle/cloud shape)\n        let circle = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n        circle.setAttributeNS(null, 'fill', color_str);\n        elem.appendChild(circle);\n\n        let p = \"\";\n        \n        // Outer circle\n        //\n\n        let theta =0;\n        let theta_step =(Math.PI*2)/out_segs;\n        let hdist =0;\n       \n        let prev_px =0; let prev_py =0;\n\n        for( let i =0; i < out_segs; i++) {\n            \n            let osc =oscillator( out_segs, i % (out_segs-1), this._parent._frame);  \n            let re =r + (osc+.5)  * s / (r*4);\n            let re1=r - (1-osc+.5) * s / (r*8);\n            let re2=r - (1-osc+.5) * s / (r*8);\n            \n            let prev_theta =theta;\n            if( i == out_segs - 1 )\n                theta =Math.PI*2;\n            else\n                theta += theta_step * (1-osc+.5);\n\n            if( i == out_segs ) theta = 2*Math.PI;\n\n            hdist =(4/3)*Math.tan( (theta-prev_theta)/4 );\n\n            let px =Math.cos( theta ) * re;\n            let py =Math.sin( theta ) * re;\n            \n            let cx1=(Math.cos( prev_theta ) - hdist * Math.sin( prev_theta )) * re1;\n            let cy1=(Math.sin( prev_theta ) + hdist * Math.cos( prev_theta )) * re1;\n\n            let cx2=(Math.cos( theta ) + hdist * Math.sin( theta  )) * re2;\n            let cy2=(Math.sin( theta ) - hdist * Math.cos( theta  )) * re2;\n            \n            if( i == 0 ) {\n                p += \" M\" + 1*re + \",\" + 0*re;\n                prev_px = 1*re; prev_py = 0*re;\n            }\n            p += \" C\" \n                + cx1.toFixed(5) + \",\" + cy1.toFixed(5) + \" \" \n                + cx2.toFixed(5) + \",\" + cy2.toFixed(5) + \" \" \n                + px.toFixed(5) + \",\" + py.toFixed(5);\n            \n            if( this._parent._showDebug ) {\n\n                // Only boring debug-stuffs below\n\n                let l1 = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n                l1.setAttributeNS(null, 'stroke-width', '0.002');\n                l1.setAttributeNS(null, 'stroke', 'white');\n                l1.setAttributeNS(null, 'd', \"M\"  \n                        + cx2.toFixed(5) + \",\" + cy2.toFixed(5) + \" L\" \n                        + px.toFixed(5) + \",\" + py.toFixed(5) + \" M\"\n                        + cx1.toFixed(5) + \",\" + cy1.toFixed(5) + \" L\" \n                        + prev_px.toFixed(5) + \",\" + prev_py + \" Z\" ); \n                this._parent.debugg.appendChild(l1);\n                \n                let h1 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n                h1.setAttributeNS(null, 'fill', 'magenta');\n                h1.setAttributeNS(null, 'width', '0.02');\n                h1.setAttributeNS(null, 'height', '0.02');\n                h1.setAttributeNS(null, 'x', cx1.toFixed(5)-0.01 );\n                h1.setAttributeNS(null, 'y', cy1.toFixed(5)-0.01 );\n                this._parent.debugg.appendChild(h1);\n                \n                let h2 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n                h2.setAttributeNS(null, 'fill', 'cyan');\n                h2.setAttributeNS(null, 'width', '0.02');\n                h2.setAttributeNS(null, 'height', '0.02');\n                h2.setAttributeNS(null, 'x', cx2.toFixed(5)-0.01 );\n                h2.setAttributeNS(null, 'y', cy2.toFixed(5)-0.01 );\n                this._parent.debugg.appendChild(h2);\n                \n                let c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n                c.setAttributeNS(null, 'fill', 'red');\n                c.setAttributeNS(null, 'r', '0.01');\n                c.setAttributeNS(null, 'cx', px.toFixed(5) );\n                c.setAttributeNS(null, 'cy', py.toFixed(5) );\n                this._parent.debugg.appendChild(c);\n            }\n\n            prev_px =px; prev_py =py;\n\n        }\n        \n        // Inner circle\n        //\n        theta =0;\n        theta_step =-(Math.PI*2)/in_segs;\n\n        for( let i =0 ; i <= in_segs; i++ ) {\n            let osc =oscillator( in_segs, i % in_segs, this._parent._frame);  \n            let re =t;// + (osc)  * 0.02\n            let re1=t;// + (osc)  * 0.01\n            let re2=t;// + (1-osc)* 0.01\n            \n            let prev_theta =theta;\n            theta += theta_step * (1-osc+.49);\n\n            if( i == in_segs ) theta = 2*Math.PI;\n\n            hdist =(4/3)*Math.tan( (theta-prev_theta)/4 );\n\n            let px =Math.cos( theta ) * re;\n            let py =Math.sin( theta ) * re;\n            \n            let cx1=(Math.cos( prev_theta ) - hdist * Math.sin( prev_theta )) * re1;\n            let cy1=(Math.sin( prev_theta ) + hdist * Math.cos( prev_theta )) * re1;\n\n            let cx2=(Math.cos( theta ) + hdist * Math.sin( theta  )) * re2;\n            let cy2=(Math.sin( theta ) - hdist * Math.cos( theta  )) * re2;\n            \n            if( i == 0 ) {\n                p += \" M\" + 1*re + \",\" + 0*re;\n                prev_px = 1*re; prev_py = 0*re;\n            }\n            p += \" C\" \n                + cx1.toFixed(5) + \",\" + cy1.toFixed(5) + \" \" \n                + cx2.toFixed(5) + \",\" + cy2.toFixed(5) + \" \" \n                + px.toFixed(5) + \",\" + py.toFixed(5);\n        }\n\n\n        circle.setAttributeNS(null, 'd', p);\n\n        // The face\n        //\n\n        this.makeFace( elem, this.thickness == 1 ? r : t, this.thickness == 1 ? this.colorbg : col );\n    }\n}\n\nclass WeerVis extends Vis {\n    constructor( annulus ) {\n        super( annulus );\n        this._palette  =[YELLOW,YELLOW2,GREY,BACKGROUND];\n        this._thickness=0.5;\n        this._segs     =10;\n    }\n\n    /* Return the SVG path obtained by rendering with the current parameters.\n     * Additionally, if showDebug is true, this function adds points and handles to the debugg SVG group element.\n     */\n    update( elem ) {\n        const r = 1.0;\n        const out_segs = this.segments; // Number of inner segments\n        const in_segs = this.segments; // Number of outer segments\n        const thickness = this.thickness; // Thickness of the ring\n        const t = r * (1.0-thickness);\n        const s = Math.pow( this._parent._stress / EXCITEMENT_SCALE,  2 );// + 0.05;\n        const color_str =rgbToHex( super.stressToColor( this._parent.stress ) ); \n\n        // Clear out old stuff\n        while( this._parent.debugg.lastChild ) this._parent.debugg.removeChild( this._parent.debugg.lastChild );\n        while( elem.lastChild ) elem.removeChild( elem.lastChild );\n\n        // Step one, the central path (cicle/cloud shape)\n        let circle = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n        circle.setAttributeNS(null, 'fill', color_str);\n        elem.appendChild(circle);\n        \n        let p = \"\";\n        \n        let theta =0;\n        let theta_step =(Math.PI*2)/out_segs;\n        let hdist =0;\n       \n        let prev_px =0; let prev_py =0;\n\n        for( let i =0; i < out_segs; i++) {\n            \n            let osc =oscillator( out_segs-1, i % (out_segs-1), this._parent._frame);  \n            let re1 =r + (osc+.5)   * s / (r*8);\n            let re2 =r - (1-osc+.5) * s / (r*16);\n            \n            let prev_theta =theta;\n            if( i == out_segs - 1 )\n                theta =Math.PI*2;\n            else\n                theta += theta_step * .75 + theta_step * .25 * (1-osc+.45);\n            //theta +=theta_step;\n            //theta =next_theta();\n\n\n            hdist =(4/3)*Math.tan( (theta-prev_theta)/4 );\n\n            let px =Math.cos( theta ) * re2;\n            let py =Math.sin( theta ) * re2;\n            \n            let cx1=(Math.cos( prev_theta ) - hdist * Math.sin( prev_theta )) * re1;\n            let cy1=(Math.sin( prev_theta ) + hdist * Math.cos( prev_theta )) * re1;\n\n            let cx2=(Math.cos( theta ) + hdist * Math.sin( theta  )) * re1;\n            let cy2=(Math.sin( theta ) - hdist * Math.cos( theta  )) * re1;\n            \n            if( i == 0 ) {\n                p += \" M\" + 1*re2 + \",\" + 0*re2;\n                prev_px = 1*re2; prev_py = 0*re2;\n            }\n            p += \" C\" \n                + cx1.toFixed(5) + \",\" + cy1.toFixed(5) + \" \" \n                + cx2.toFixed(5) + \",\" + cy2.toFixed(5) + \" \" \n                + px.toFixed(5) + \",\" + py.toFixed(5);\n            \n            if( this._parent._showDebug ) {\n\n                // Only boring debug-stuffs below\n\n                let l1 = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n                l1.setAttributeNS(null, 'stroke-width', '0.002');\n                l1.setAttributeNS(null, 'stroke', 'white');\n                l1.setAttributeNS(null, 'd', \"M\"  \n                        + cx2.toFixed(5) + \",\" + cy2.toFixed(5) + \" L\" \n                        + px.toFixed(5) + \",\" + py.toFixed(5) + \" M\"\n                        + cx1.toFixed(5) + \",\" + cy1.toFixed(5) + \" L\" \n                        + prev_px.toFixed(5) + \",\" + prev_py + \" Z\" ); \n                this._parent.debugg.appendChild(l1);\n                \n                let h1 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n                h1.setAttributeNS(null, 'fill', 'magenta');\n                h1.setAttributeNS(null, 'width', '0.02');\n                h1.setAttributeNS(null, 'height', '0.02');\n                h1.setAttributeNS(null, 'x', cx1.toFixed(5)-0.01 );\n                h1.setAttributeNS(null, 'y', cy1.toFixed(5)-0.01 );\n                this._parent.debugg.appendChild(h1);\n                \n                let h2 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n                h2.setAttributeNS(null, 'fill', 'cyan');\n                h2.setAttributeNS(null, 'width', '0.02');\n                h2.setAttributeNS(null, 'height', '0.02');\n                h2.setAttributeNS(null, 'x', cx2.toFixed(5)-0.01 );\n                h2.setAttributeNS(null, 'y', cy2.toFixed(5)-0.01 );\n                this._parent.debugg.appendChild(h2);\n                \n                let c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n                c.setAttributeNS(null, 'fill', 'red');\n                c.setAttributeNS(null, 'r', '0.01');\n                c.setAttributeNS(null, 'cx', px.toFixed(5) );\n                c.setAttributeNS(null, 'cy', py.toFixed(5) );\n                this._parent.debugg.appendChild(c);\n            }\n\n            prev_px =px; prev_py =py;\n\n        }\n        circle.setAttributeNS(null, 'd', p);\n        \n        // Step two. The face\n        //\n\n        this.makeFace( elem, r, this.colorbg );\n\n      /*  let l = this._parent._stress < .5 ? 0 : 1;\n        let r2=(10 * (.5 - Math.abs(.5 - this._parent._stress)) + .5) * r; \n        p = \" M \" + -.5 * r + \", 0 A\" + r2 + \", \" + r2 + \" 0 0,\" + l + \" \" + .5 * r + \",0\";\n        let mouth = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n        mouth.setAttributeNS(null, 'fill', 'none');\n        mouth.setAttributeNS(null, 'stroke', 'black');\n        mouth.setAttributeNS(null, 'stroke-width', .1 * r);\n        mouth.setAttributeNS(null, 'd', p );\n        elem.appendChild(mouth);*/\n\n\n        // Step three. The rays/sparks/lines\n        // Each line is a separate <polyline> that consists of four points\n        let line_segs =2 * in_segs + in_segs * 2 * (1- this._parent._stress); \n        //let skip_lines =Math.floor(in_segs * 2 * (1.1- this._parent._stress)); \n        theta =0;//Math.PI /4 * s;\n        theta_step =-(Math.PI*2)/line_segs;// + (Math.PI*2)/(in_segs*4);\n\n        for( let i =0 ; i < line_segs; i++ ) {\n            let osc =oscillator( line_segs, i % (line_segs), this._parent._frame);  \n            let soff= r * 0.15 * s;     // Stress factor in offset from inner circle\n            let re  = 1.1 * r + .2 * r * osc + soff; // Distance of tangential line\n            let re1 = re + soff;         // Distance of outmost point\n            let re2 = re - soff;         // Distance of innermost point\n            \n            let prev_theta =theta;\n            if( i == line_segs - 1 )\n                theta =0;//Math.PI/4 * s - theta_step;\n            else\n                theta += theta_step * .75 + theta_step * .25 * (1-osc+.45);\n\n            //if( i % skip_lines == 0 ) continue;\n\n            hdist =(4/3)*Math.tan( (theta-prev_theta)/4 );\n\n            // Points of the middle/tangential line\n            let px1 =Math.cos( prev_theta ) * re;\n            let py1 =Math.sin( prev_theta ) * re;\n            \n            let px2 =Math.cos( theta - .75 * theta_step ) * re;\n            let py2 =Math.sin( theta - .75 * theta_step ) * re;\n            \n        \n            // Outer/inner points that form the 'spark'     \n            let cx1=Math.cos( prev_theta ) * re1;\n            let cy1=Math.sin( prev_theta ) * re1;\n\n            let cx2=Math.cos( theta  - .75 * theta_step ) * re2;\n            let cy2=Math.sin( theta  - .75 * theta_step ) * re2;\n           \n            let points = cx1 + \",\" + cy1 + \" \" + px1 + \",\" + py1 + \" \" + px2 + \",\" + py2 + \" \" + cx2 + \",\" + cy2;\n            let e= document.createElementNS('http://www.w3.org/2000/svg', 'polyline');\n            e.setAttributeNS(null, 'fill', 'none');\n            e.setAttributeNS(null, 'stroke', color_str/*rgbToHex(this.color0)*/);\n            e.setAttributeNS(null, 'stroke-width', .05 * r);\n            e.setAttributeNS(null, 'stroke-linecap', 'round');\n            e.setAttributeNS(null, 'stroke-linejoin', 'round');\n            e.setAttributeNS(null, 'points', points );\n            elem.appendChild(e);\n\n        }\n\n    }\n}\n\nclass Annulus {\n\n    constructor( svgarea  ) {\n        this._stress            =0.0;\n        this._showDebug         =false;\n        this._frame             =0;\n        this._time              =0;\n        this._speed             =0.000008;\n        this._animate           =true;\n        this._vis               =null;\n        this._animateStress     =false;\n        this._animateStressSign =1.0;\n        this.svgarea = svgarea;\n\n        svgarea.viewbox = [-2,-2,4,4];\n        \n        \n        // Add a group for visualisation elements\n        this.pathg = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n        this.svgarea.svg_elem.appendChild(this.pathg);\n        \n        // Add another group for debug elements\n        this.debugg = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n        this.svgarea.svg_elem.appendChild(this.debugg);\n\n\n    }\n    \n    get color0()        { return this._vis.color0; }\n    set color0(c)       { this._vis.color0 =c; this.update(); }\n    get color1()        { return this._vis.color1; }\n    set color1(c)       { this._vis.color1 =c; this.update(); }\n    get color2()        { return this._vis.color2; }\n    set color2(c)       { this._vis.color2 =c; this.update(); }\n    get colorbg()       { return this._vis.colorbg; }\n    set colorbg(c)      { this._vis.colorbg =c; this.update(); }\n\n    get stress()        { return this._stress; }\n    set stress(e)       { this._stress = e; this.update(); }\n\n    get showDebug()     { return this._showDebug; }\n    set showDebug(b)    { this._showDebug =b; this.update(); }\n\n    get frame()         { return this._frame; }\n    set frame(f)        { this._frame =f; this.update(); }\n\n    get animate()       { return this._animate; }\n    set animate(b)      { this._animate = b; this.start(); }\n\n    get animateStress() { return this._animateStress; }\n    set animateStress(b){ this._animateStress =b; }\n\n    get segments()      { return this._vis.segments; }\n    set segments(n)     { this._vis.segments = n; this.update() }\n\n    get thickness()     { return this._vis.thickness; }\n    set thickness(n)    { this._vis.thickness =n; this.update() }\n\n    get visualisation() { return this._vis; }\n    set visualisation(v){ this._vis =v; this.update(); }\n\n    get face()          { return this._vis.face; }\n    set face(n)         { this._vis.face =n; this.update(); }\n    \n\n    update() {\n        this._vis.update( this.pathg );\n    }\n\n    start() {\n        if( this._animate == false ) return;\n\n        const animateStep = (timestamp) => {\n            if( this._animate == false ) return;\n            if( !this._time ) this._time =timestamp;\n            let delta = timestamp - this._time;\n            \n            if( this._animateStress == true ) {\n\n                this._stress += delta * 0.0001 * this._animateStressSign;\n                if( this._stress >= 1.0 ) {\n                    this._animateStressSign =-1.0;\n                    this._stress =1.0;\n                } else if( this._stress <= 0.0 ) {\n                    this._animateStressSign =1.0;\n                    this._stress =0.0;\n                }\n            }\n            \n            this._frame += delta * (this._speed + this._stress * this._speed);\n            while( this._frame >= 1.0 ) this._frame -= 1.0;\n\n            this._time = timestamp;\n            this.update();\n            window.requestAnimationFrame( animateStep );\n        }\n        window.requestAnimationFrame( animateStep );\n    }\n\n\n\n\n}\n\nclass App {\n    constructor( { container_id ='' } ) {\n        console.log( 'niemand ter aarde weet, hoe het eigenlijk begon, het droevige verhaal van de nozem en de non' );\n\n\n        // Create a viewport container inside the given element id\n        this.container_elem =document.getElementById( container_id );\n        if( typeof this.container_elem == 'undefined' )\n            this.container_elem =document.body;\n\n        let svg_elem = document.createElement( 'object' );\n            svg_elem.className = 'svgarea';\n        this.container_elem.appendChild( svg_elem );\n\n        this.svgarea = new SVGArea( { container_elem: svg_elem } );\n\n        this.annulus = new Annulus( this.svgarea );\n\n        this.visList = { \"Ring\" : new RingVis( this.annulus ), \"Weer\" : new WeerVis( this.annulus ) };\n        this._vis =\"\";\n        this.vis = \"Ring\";\n        this.annulus.face =FACE_COMPLEX;\n        this.annulus.start();\n\n        this.backgroundColor = BACKGROUND;\n        this.setupToolbox();\n    }\n\n    get vis()   { return this._visstr; }\n    set vis(str){ \n        this._visstr =str;\n        this.annulus.visualisation =this.visList[str];\n        this.annulus.update();\n    }\n\n    get backgroundColor() { return this._background; }\n\n    set backgroundColor(c) {\n        this._background =c;\n        document.body.style.background = rgbToHex(c);\n        this.annulus.colorbg =c;\n        this.annulus.update();\n    }\n\n    setupToolbox() {\n        this.toolbox = new dat.GUI( );\n        \n        let f_a = this.toolbox.addFolder( 'Annulus' );\n        f_a.add( this.annulus, 'stress', 0.0, EXCITEMENT_SCALE ).name( 'Stress' ).step( 0.01 * EXCITEMENT_SCALE ).listen();\n        f_a.add( this, 'vis', [ \"Ring\", \"Weer\" ] ).name( 'Vis' );\n        f_a.add( this.annulus, 'face', { None : FACE_NONE, Simple : FACE_SIMPLE, Troubled : FACE_TROUBLED, Sad : FACE_SAD, Complex : FACE_COMPLEX } ).name( 'Face' );\n        f_a.open();\n\n        // Colors toolbox\n        let f_c = this.toolbox.addFolder( 'Colors' );\n        f_c.addColor( this.annulus, 'color0' ).name( 'Low' ).listen() ;\n        f_c.addColor( this.annulus, 'color1' ).name( 'Medium' ).listen();\n        f_c.addColor( this.annulus, 'color2' ).name( 'High' ).listen();\n        f_c.addColor( this, 'backgroundColor' ).name( 'Background' ).listen();\n        f_c.open();\n        \n        let f_p = this.toolbox.addFolder( 'Parameters' );\n        f_p.add( this.annulus, 'showDebug' ).name( 'Debug' );\n        //f_p.add( this.annulus, 'frame', 0.0, 1.0 ).name( 'Frame' ).step( 0.01);\n        f_p.add( this.annulus, 'segments', 10, 100 ).name( 'Segments' ).step( 1 ).listen();\n        f_p.add( this.annulus, 'thickness', 0, 1 ).name( 'Thickness' ).step( 0.05 ).listen();\n        f_p.add( this.annulus, 'animate' ).name( 'Animate' );\n        f_p.add( this.annulus, 'animateStress' ).name( 'Animate Stress' );\n        f_p.open();\n\n    }\n}\n\nexport default {\n    App : App\n};\n"],"sourceRoot":""}